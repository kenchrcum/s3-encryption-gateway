# Milestone v0.6 — Issue Tracker and Implementation Guide

This document tracks all issues for v0.6 with implementation guides, tests, and acceptance criteria derived from `docs/ROADMAP.md`.

## Scope and Goals
- Security/Crypto: Pluggable KeyManager, optional FIPS-compliant crypto build profile
- S3 Compatibility: Multipart copy; Object Lock/Retention passthrough guidance
- Performance: Zero-copy streaming paths where feasible; retry policy customization
- Observability: pprof endpoints gated behind admin flag; profiling recipes
- Operations & Helm/K8s: Blue/green and canary examples; values validation/schema
- Config & UX: Admin API for safe key rotation (drain + cutover)
- Testing & Quality: Performance baselines; coverage gate >=80%; mutation testing on crypto-free critical code
- Docs: Migration guide for enabling KMS mode from single-password

## Milestone Acceptance Criteria
- Coverage gate (>=80%) and mutation testing on critical crypto-free code.
- Helm values validation (schema/JSONSchema) and default overlays.

Labels: `milestone:v0.6`, `area:kms`, `area:s3`, `area:perf`, `area:observability`, `area:helm`, `area:testing`.

---

## [V0.6-SEC-1] Pluggable KeyManager Interface
- Owner: Crypto
- Priority: P0

### Summary
Refactor to a pluggable `KeyManager` interface to enable HSM-friendly adapters.

### Affected
- `internal/crypto/keymanager.go`
- `internal/crypto/engine.go`
- `internal/config/config.go`

### Implementation Guide
- [ ] Extract stable interface; document invariants and zeroization.
- [ ] Provide adapters: in-memory, KMS (from v0.5), placeholder HSM adapter.
- [ ] Migrate engine to depend only on interface.

### Tests
- Unit: interface compliance; mocks

### Definition of Done
- [ ] Engine compiles against interface; adapters covered by tests

---

## [V0.6-SEC-2] FIPS-Compliant Crypto Profile (Optional)
- Owner: Crypto
- Priority: P2

### Summary
Provide optional FIPS build profile; document constraints.

### Implementation Guide
- [ ] Build tags or modules; verify algorithms and sources.

### Definition of Done
- [ ] Build profile documented and verifiable

---

## [V0.6-S3-1] Multipart Copy Support
- Owner: API
- Priority: P1

### Summary
Add multipart copy; ensure correctness with encrypted sources.

### Affected
- `internal/api/handlers.go`
- `internal/s3/client.go`

### Implementation Guide
- [ ] Support `UploadPartCopy`; handle range/ETag translation.

### Tests
- Integration: copy large encrypted objects across buckets

### Definition of Done
- [ ] Copy works across providers and sizes

---

## [V0.6-S3-2] Object Lock/Retention Pass-through
- Owner: API
- Priority: P2

### Summary
Guidance and tests for pass-through of Object Lock/Retention headers.

### Definition of Done
- [ ] Documented behavior; tests for supported providers

---

## [V0.6-PERF-1] Zero-Copy Streaming Where Feasible
- Owner: Perf
- Priority: P1

### Summary
Identify and implement zero-copy paths to reduce CPU/mem overhead.

### Affected
- `internal/crypto/*`
- `internal/s3/proxy_client.go`

### Implementation Guide
- [ ] Audit copy points; replace with io.CopyBuffer / direct piping; preserve AEAD guarantees.

### Tests
- Benchmarks; integration with large objects

### Definition of Done
- [ ] Reduced CPU and GC pressure in benchmarks

---

## [V0.6-PERF-2] Retry Policy Customization
- Owner: Perf/API
- Priority: P2

### Summary
Expose retry/backoff settings and tune defaults.

### Affected
- `internal/s3/client.go`
- `internal/config/config.go`

### Implementation Guide
- [ ] Configurable retry policy; exponential backoff; idempotency safeguards.

### Definition of Done
- [ ] Resilient behavior under transient failures

---

## [V0.6-OBS-1] pprof Endpoints (Admin)
- Owner: Observability
- Priority: P1

### Summary
Add pprof endpoints behind admin flag and document profiling recipes.

### Affected
- `internal/metrics/health.go`
- `cmd/server/main.go`
- `internal/config/config.go`

### Implementation Guide
- [ ] Admin flag gating; TLS-restricted; disabled by default.

### Tests
- Manual validation; unit tests for flag gating

### Definition of Done
- [ ] Profiling works safely when enabled

---

## [V0.6-OPS-1] Blue/Green & Canary Examples
- Owner: Helm
- Priority: P1

### Summary
Provide blue/green and canary deployment examples (Ingress/Service).

### Affected
- `helm/s3-encryption-gateway/templates/*`
- `helm/s3-encryption-gateway/README.md`

### Implementation Guide
- [ ] Example manifests and Helm values overlays.

### Definition of Done
- [ ] Examples render; docs clear

---

## [V0.6-OPS-2] Helm Values Validation (Schema)
- Owner: Helm
- Priority: P0

### Summary
Add JSONSchema for values and default overlays.

### Affected
- `helm/s3-encryption-gateway/values.yaml`
- `helm/s3-encryption-gateway/Chart.yaml`

### Implementation Guide
- [ ] Provide `values.schema.json`; CI `helm lint` gating.

### Definition of Done
- [ ] Lint passes with schema; defaults validated

---

## [V0.6-CFG-1] Admin API for Key Rotation
- Owner: Config/Crypto
- Priority: P1

### Summary
Provide admin API to coordinate safe key rotation (drain + cutover).

### Affected
- `internal/api/handlers.go` (admin routes)
- `internal/crypto/engine.go`
- `internal/crypto/keymanager.go`

### Implementation Guide
- [ ] Endpoint to start drain, monitor progress, perform cutover.
- [ ] AuthN/AuthZ controls; audit events.

### Definition of Done
- [ ] Rotation workflow demonstrated end-to-end

---

## [V0.6-QA-1] Performance Baselines per Provider
- Owner: QA/Perf
- Priority: P1

### Summary
Establish and document performance baselines per provider.

### Definition of Done
- [ ] Baseline report added to docs and CI graphs

---

## [V0.6-QA-2] Coverage Gate >=80% + Mutation Testing
- Owner: QA
- Priority: P0

### Summary
Introduce coverage gate and mutation testing for critical crypto-free code paths.

### Implementation Guide
- [ ] CI step enforcing coverage; mutation tests via selected tool.

### Definition of Done
- [ ] Gates enforced; reports present in CI artifacts

---

## [V0.6-DOC-1] Migration Guide: Single-Password → KMS Mode
- Owner: Docs
- Priority: P2

### Summary
Guide to enable KMS mode from single-password deployment with minimal downtime.

### Definition of Done
- [ ] Guide published and validated in a demo

---

## Tracking Checklist (Milestone Level)
- [ ] All P0/P1 closed
- [ ] Coverage gate active
- [ ] Schema validation in place
- [ ] Migration guide reviewed
